(function(){
'use strict';
angular.module('keyManagement', ['ui.router','ngTable', 'ui.bootstrap.datetimepicker'])

.config(["$stateProvider", "$urlRouterProvider", function($stateProvider, $urlRouterProvider){
  $urlRouterProvider.otherwise('/');
   $stateProvider
        .state('home', {
            url: '/',
            views : {
                'header': {
                  templateUrl: 'min_partials/header.html'
                },
                'content' : {
                    templateUrl: 'min_partials/content.html',
                    controller : 'mainController'
                },
                'footer' : {
                    templateUrl: 'min_partials/footer.html'
                },
                'left' : {
                    templateUrl: 'min_partials/leftMenu.html'
                }
          }
        })
}]);
})();
(function() {
    "use strict";

    angular.module('keyManagement').controller('mainController', ["NgTableParams", "loadJson", "$scope", "datepickerBeforeRender",function (NgTableParams,loadJson,$scope,datepickerBeforeRender){
    	loadJson.getTableDefaultList().then(function(tableData) {
    		$scope.data =  tableData;
		});

		$scope.showModal = false;
	    $scope.toggleModal = function(){
	        $scope.showModal = !$scope.showModal;
	    };

	    $scope.isValidationModeDisabled = true;
	    $scope.isSizeOfKeyDisabled = true;

	    $scope.change = function(val) {
	        if(val === "t1" || val === "t3"){
	        	$scope.isValidationModeDisabled = false;
	        }else if(val === "t2" || val === "t4"){
	        	$scope.isValidationModeDisabled = true;
	        }
	    };

	    $scope.changeValidationMode = function(){
	    	$scope.isSizeOfKeyDisabled = false;
	    };

	    $scope.addDataToTable = function(){
	    	console.log($scope.descriptionNew);
	    	alert("Generated Key  ::: "+Math.random().toString(36).substr(2, 16));
	    };

	    $scope.beforeRender = function ($dates) {
		    datepickerBeforeRender.getBeforeRender($dates); 
		};
		
    }]);
})();

(function(){
"use strict";

  angular.module('keyManagement').directive('datamodal', function () {
    return {
      template: '<div class="modal fade">' + 
          '<div class="modal-dialog">' + 
            '<div class="modal-content">' + 
              '<div class="modal-header">' + 
                '<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>' + 
                '<h4 class="modal-title">{{ title }}</h4>' + 
              '</div>' + 
              '<div class="modal-body" ng-transclude></div>' + 
            '</div>' + 
          '</div>' + 
        '</div>',
      restrict: 'E',
      transclude: true,
      replace:true,
      scope:true,
      link: function postLink(scope, element, attrs) {
        scope.title = attrs.title;

        scope.$watch(attrs.visible, function(value){
          if(value == true)
            $(element).modal('show');
          else
            $(element).modal('hide');
        });

        $(element).on('shown.bs.modal', function(){
          scope.$apply(function(){
            scope.$parent[attrs.visible] = true;
          });
        });

        $(element).on('hidden.bs.modal', function(){
          scope.$apply(function(){
            scope.$parent[attrs.visible] = false;
          });
        });
      }
    };
  });
  })();
(function() {
    'use strict';

    var today = new Date();
    angular.module('keyManagement')
    .factory('datepickerBeforeRender',function() {
        return {
            getBeforeRender: function($dates) {
                var prevDate = (today.getDate()) - 1;
                today.setDate(prevDate);
                for(var d in $dates){         
                    if($dates[d].utcDateValue<today){
                        $dates[d].selectable = false
                    }
                }
                return $dates;
            }
        }
    });
})();
(function() {
    'use strict';
    angular.module('keyManagement').factory('loadJson', ['$http', function($http) {
        return {
            getTableDefaultList: function() {
                var tableDefaultList = $http.get('assets/js/json/table_data.json').then(function(response) {
                    return response.data;
                });
                return tableDefaultList;
            }
        }
    }]);
})();